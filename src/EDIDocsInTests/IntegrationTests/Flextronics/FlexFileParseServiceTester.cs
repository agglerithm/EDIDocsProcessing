using System.Linq;
using EDIDocsIn.config;
using EDIDocsProcessing.Common;
using EDIDocsProcessing.Common.Extensions;
using Microsoft.Practices.ServiceLocation;
using NUnit.Framework;

namespace EDIDocsProcessing.Tests.IntegrationTests.Flextronics
{
    [TestFixture]
    public class FlexFileParseServiceTester
    {
        private IFileParser _sut;

        [TestFixtureSetUp]
        public void SetUp()
        {
            StructureMapBootstrapper.Execute();
            _sut = BusinessPartner.Flextronics.Parser(); 
        }

        [Test]
        public void can_split_string_old_school()
        {
            string contents =
                @"ISA*00*          *00*          *ZZ*SLRSCOREGTWY   *12*EEC5122516063  *110317*0839*U*00401*000000042*1*P*~|GS*PO*SLR010*EEC5122516063*20110317*0839*25*X*004010|ST*850*170839152|BEG*00*SA*4110203989**20110317|CUR*BY*USD|PER*BD*Brenda Fritz*TE*512-425-6314|TAX*17705871287***********3|FOB*DF*OR|N1*SE**92*0013000188|N1*BT*Flextronics America, LLC*92*12T1|N4*LAREDO*TX*78041*US|N1*ST**92*S101|PO1*00010*54*EA*5.38*PE*BP*100000000019*EC*06*VP*2233249-0001*PN*PK22332490003|MSG*RoHS5/6|SCH*54*EA***002*20110404|PKG*F****Bulk packaging|CTT*1|SE*16*170839152|GE*1*25|IEA*1*000000042|";

            var splitter = ServiceLocator.Current.GetInstance<ISegmentSplitter>();
            var segs = splitter.Split(contents);
            var customerOrders = _sut.Parse(segs);


            customerOrders.Count().ShouldEqual(1);
        }

        [Test]
        public void can_split_string()
        {
            string contents = @"ISA*00*          *00*          *ZZ*SLRSCOREGTWY   *ZZ*EEC5122516063  *090616*0947*U*00401*000001248*0*P*~|GS*PO*SLR010*EEC5122516063*20090616*0947*635*X*004010|ST*850*0001|BEG*00*SA*4110140606**20090616|CUR*BY*USD|PER*BD*Flex Buyer*TE*512-425-7577|TAX*3-20-3665150-6***********3|FOB*DF*OR|N1*SE**92*0013000196|N1*BT*Flextronics America, LLC*92*12T1|N4*LAREDO*TX*78041*US|N1*ST**92*S101|PO1*00010*20000*EA*0.00001*PE*BP*100000016882*EC*06*VP*VENDOR-PART-NO*PN*11-1836-01*EC*A0|PID*F*ITEM DESCRIPTION|REF*IT*CIS01|MSG*RoHS5/6|SCH*20000.000*EA***002*20100211|PKG*F****Tape&Reel per current EIA spec|CTT*1|SE*18*0001|GE*1*635|IEA*1*000001248|";

            var splitter = ServiceLocator.Current.GetInstance<ISegmentSplitter>();
            var segs = splitter.Split(contents);
            var customerOrders =   _sut.Parse(segs);
             
            customerOrders.Count().ShouldEqual(1);
        }

        [Test, ExpectedException("EDIDocsProcessing.Core.DocsIn.impl.EDIWorkflowException")]
        public void can_split_long_string()
        {
            string contents =
                @"ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000598*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*598*X*004010~ST*997*0001~AK1*IN*000110016~AK2*850*2334~AK9*A*1*1*1~SE*4*0001~GE*1*598~IEA*1*700000598~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000599*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*599*X*004010~ST*997*0001~AK1*IN*000110017~AK9*A*1*1*1~SE*4*0001~GE*1*599~IEA*1*700000599~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000600*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*600*X*004010~ST*997*0001~AK1*IN*000110018~AK9*A*1*1*1~SE*4*0001~GE*1*600~IEA*1*700000600~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000601*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*601*X*004010~ST*997*0001~AK1*IN*000110019~AK9*A*1*1*1~SE*4*0001~GE*1*601~IEA*1*700000601~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000602*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*602*X*004010~ST*997*0001~AK1*IN*000110020~AK9*A*1*1*1~SE*4*0001~GE*1*602~IEA*1*700000602~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000603*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*603*X*004010~ST*997*0001~AK1*IN*000110021~AK9*A*1*1*1~SE*4*0001~GE*1*603~IEA*1*700000603~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000604*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*604*X*004010~ST*997*0001~AK1*IN*000110023~AK9*A*1*1*1~SE*4*0001~GE*1*604~IEA*1*700000604~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000605*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*605*X*004010~ST*997*0001~AK1*IN*000110022~AK9*A*1*1*1~SE*4*0001~GE*1*605~IEA*1*700000605~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000606*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*606*X*004010~ST*997*0001~AK1*IN*000110025~AK9*A*1*1*1~SE*4*0001~GE*1*606~IEA*1*700000606~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000607*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*607*X*004010~ST*997*0001~AK1*IN*000110024~AK9*A*1*1*1~SE*4*0001~GE*1*607~IEA*1*700000607~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000608*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*608*X*004010~ST*997*0001~AK1*IN*000110026~AK9*A*1*1*1~SE*4*0001~GE*1*608~IEA*1*700000608~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000609*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*609*X*004010~ST*997*0001~AK1*IN*000110028~AK9*A*1*1*1~SE*4*0001~GE*1*609~IEA*1*700000609~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000610*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*610*X*004010~ST*997*0001~AK1*IN*000110030~AK9*A*1*1*1~SE*4*0001~GE*1*610~IEA*1*700000610~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000611*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*611*X*004010~ST*997*0001~AK1*IN*000110027~AK9*A*1*1*1~SE*4*0001~GE*1*611~IEA*1*700000611~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000612*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*612*X*004010~ST*997*0001~AK1*IN*000110029~AK9*A*1*1*1~SE*4*0001~GE*1*612~IEA*1*700000612~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000613*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*613*X*004010~ST*997*0001~AK1*IN*000110032~AK9*A*1*1*1~SE*4*0001~GE*1*613~IEA*1*700000613~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000614*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*614*X*004010~ST*997*0001~AK1*IN*000110031~AK9*A*1*1*1~SE*4*0001~GE*1*614~IEA*1*700000614~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000615*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*615*X*004010~ST*997*0001~AK1*IN*000110033~AK9*A*1*1*1~SE*4*0001~GE*1*615~IEA*1*700000615~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000616*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*616*X*004010~ST*997*0001~AK1*IN*000110034~AK9*A*1*1*1~SE*4*0001~GE*1*616~IEA*1*700000616~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000617*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*617*X*004010~ST*997*0001~AK1*IN*000110035~AK9*A*1*1*1~SE*4*0001~GE*1*617~IEA*1*700000617~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000618*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*618*X*004010~ST*997*0001~AK1*IN*000110036~AK9*A*1*1*1~SE*4*0001~GE*1*618~IEA*1*700000618~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000619*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*619*X*004010~ST*997*0001~AK1*IN*000110037~AK9*A*1*1*1~SE*4*0001~GE*1*619~IEA*1*700000619~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000620*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*620*X*004010~ST*997*0001~AK1*IN*000110038~AK9*A*1*1*1~SE*4*0001~GE*1*620~IEA*1*700000620~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000621*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*621*X*004010~ST*997*0001~AK1*IN*000110039~AK9*A*1*1*1~SE*4*0001~GE*1*621~IEA*1*700000621~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000622*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*622*X*004010~ST*997*0001~AK1*IN*000110040~AK9*A*1*1*1~SE*4*0001~GE*1*622~IEA*1*700000622~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000623*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*623*X*004010~ST*997*0001~AK1*IN*000110041~AK9*A*1*1*1~SE*4*0001~GE*1*623~IEA*1*700000623~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000624*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*624*X*004010~ST*997*0001~AK1*IN*000050005~AK9*A*1*1*1~SE*4*0001~GE*1*624~IEA*1*700000624~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000625*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*625*X*004010~ST*997*0001~AK1*IN*000050007~AK9*A*1*1*1~SE*4*0001~GE*1*625~IEA*1*700000625~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000626*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*626*X*004010~ST*997*0001~AK1*IN*000050006~AK9*A*1*1*1~SE*4*0001~GE*1*626~IEA*1*700000626~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000627*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*627*X*004010~ST*997*0001~AK1*IN*000050008~AK9*A*1*1*1~SE*4*0001~GE*1*627~IEA*1*700000627~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000628*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*628*X*004010~ST*997*0001~AK1*IN*000050009~AK9*A*1*1*1~SE*4*0001~GE*1*628~IEA*1*700000628~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000629*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*629*X*004010~ST*997*0001~AK1*IN*000050010~AK9*A*1*1*1~SE*4*0001~GE*1*629~IEA*1*700000629~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000630*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*630*X*004010~ST*997*0001~AK1*IN*000050012~AK9*A*1*1*1~SE*4*0001~GE*1*630~IEA*1*700000630~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000631*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*631*X*004010~ST*997*0001~AK1*IN*000050011~AK9*A*1*1*1~SE*4*0001~GE*1*631~IEA*1*700000631~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000632*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*632*X*004010~ST*997*0001~AK1*IN*000050013~AK9*A*1*1*1~SE*4*0001~GE*1*632~IEA*1*700000632~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000633*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*633*X*004010~ST*997*0001~AK1*IN*000050014~AK9*A*1*1*1~SE*4*0001~GE*1*633~IEA*1*700000633~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000634*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*634*X*004010~ST*997*0001~AK1*IN*000050016~AK9*A*1*1*1~SE*4*0001~GE*1*634~IEA*1*700000634~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000635*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*635*X*004010~ST*997*0001~AK1*IN*000050015~AK9*A*1*1*1~SE*4*0001~GE*1*635~IEA*1*700000635~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000636*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*636*X*004010~ST*997*0001~AK1*IN*000050017~AK9*A*1*1*1~SE*4*0001~GE*1*636~IEA*1*700000636~ISA*00*          *00*          *08*049691426SAC   *12*EEC5122516063  *091116*1237*U*00401*700000637*0*P*>~GS*FA*SLR077*EEC5122516063*20091116*1237*637*X*004010~ST*997*0001~AK1*IN*000050018~AK9*A*1*1*1~SE*4*0001~GE*1*637~IEA*1*700000637~";

            var splitter = ServiceLocator.Current.GetInstance<ISegmentSplitter>();
            var segs = splitter.Split(contents);
            var docs = _sut.Parse(segs);
             
        }
    }
}